<!DOCTYPE html>
<html lang>
  <head><meta name="generator" content="Hexo 3.9.0">
    
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



  <meta name="description" content="Centos 安装gitlab">




  <meta name="keywords" content="git,">





    <link rel="alternate" href="/default" title="浮生若梦">




    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.1">



<link rel="canonical" href="http://yoursite.com/2014/05/06/centos-install-gitlab/">


<meta name="description" content="Centos 安装gitlab下载下载页面下载centos版本对应的rpm包https://www.gitlab.com/downloads/ ###安装 sudo yum install openssh-server sudo yum install postfix # sendmail or exim is also OK sudo rpm -i gitlab-x.y.z_omnibus-x.">
<meta name="keywords" content="git">
<meta property="og:type" content="article">
<meta property="og:title" content="Centos 安装gitlab">
<meta property="og:url" content="http://yoursite.com/2014/05/06/centos-install-gitlab/index.html">
<meta property="og:site_name" content="浮生若梦">
<meta property="og:description" content="Centos 安装gitlab下载下载页面下载centos版本对应的rpm包https://www.gitlab.com/downloads/ ###安装 sudo yum install openssh-server sudo yum install postfix # sendmail or exim is also OK sudo rpm -i gitlab-x.y.z_omnibus-x.">
<meta property="og:locale" content="cn">
<meta property="og:image" content="http://yoursite.com/2014/05/06/centos-install-gitlab/doc/images/omnibus-documentation-version.png">
<meta property="og:updated_time" content="2020-03-13T14:33:53.237Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Centos 安装gitlab">
<meta name="twitter:description" content="Centos 安装gitlab下载下载页面下载centos版本对应的rpm包https://www.gitlab.com/downloads/ ###安装 sudo yum install openssh-server sudo yum install postfix # sendmail or exim is also OK sudo rpm -i gitlab-x.y.z_omnibus-x.">
<meta name="twitter:image" content="http://yoursite.com/2014/05/06/centos-install-gitlab/doc/images/omnibus-documentation-version.png">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1">
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">





<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: false
    },
  };
</script>




    





    





    <title> Centos 安装gitlab - 浮生若梦 </title>
  </head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">浮生若梦</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/archives">
                            
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/about">
                            
                            
                                About
                            
                        </a>
                    </li>
                
                
            </ul>
        
    </nav>

</div>

      </header>
      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          Centos 安装gitlab
        
      </h1>

      <time class="post-time">
          May 6 2014
      </time>
    </header>



    
            <div class="post-content">
            <h1 id="Centos-安装gitlab"><a href="#Centos-安装gitlab" class="headerlink" title="Centos 安装gitlab"></a>Centos 安装gitlab</h1><h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p>下载页面下载centos版本对应的rpm包<br><a href="https://www.gitlab.com/downloads/" target="_blank" rel="noopener">https://www.gitlab.com/downloads/</a></p>
<p>###安装</p>
<p><code>sudo yum install openssh-server sudo yum install postfix # sendmail or exim is also OK sudo rpm -i gitlab-x.y.z_omnibus-x.el6.x86_64.rpm # this is the .rpm you downloaded sudo gitlab-ctl reconfigure sudo lokkit -s http -s ssh # open up the firewall for HTTP and SSH requests</code></p>
<p>就O了</p>
<h3 id="安装后"><a href="#安装后" class="headerlink" title="安装后"></a>安装后</h3><p>执行 <code>sudo gitlab-ctl status</code>; 查看状态:</p>
<p><code>run: nginx: (pid 972) 7s; run: log: (pid 971) 7s run: postgresql: (pid 962) 7s; run: log: (pid 959) 7s run: redis: (pid 964) 7s; run: log: (pid 963) 7s run: sidekiq: (pid 967) 7s; run: log: (pid 966) 7s run: unicorn: (pid 961) 7s; run: log: (pid 960) 7s</code><br>nginx使用80端口, unicorn使用8080端口, 有冲突的话会启动失败<br>默认用户名 <code>root</code> 密码 <code>5iveL!fe</code></p>
<p><a href="https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/README.md" target="_blank" rel="noopener">官方安装文档</a></p>
<a id="more"></a>

<ul>
<li>GitLab Omnibus project</li>
</ul>
<blockquote>
<p>This project creates full-stack platform-specific <a href="https://www.gitlab.com/downloads" target="_blank" rel="noopener">downloadable packages for GitLab</a>. For other installation options please see the <a href="https://gitlab.com/gitlab-org/gitlab-ce/blob/master/README.md" target="_blank" rel="noopener">GitLab project README</a>.</p>
</blockquote>
<ul>
<li>Documentation version</li>
</ul>
<blockquote>
<p>Please make sure you are viewing the documentation for the version of omnibus-gitlab you are using. In most cases this should be the highest numbered stable branch (example shown below).</p>
</blockquote>
<p><img src="doc/images/omnibus-documentation-version.png" alt="documentation version"></p>
<ul>
<li>Installation</li>
</ul>
<blockquote>
<p>Please <a href="https://www.gitlab.com/downloads" target="_blank" rel="noopener">download the package</a> and follow the steps below.</p>
</blockquote>
<h3 id="Ubuntu-12-04"><a href="#Ubuntu-12-04" class="headerlink" title="Ubuntu 12.04"></a>Ubuntu 12.04</h3><p><code>sudo apt-get install openssh-server sudo apt-get install postfix # sendmail or exim is also OK sudo dpkg -i gitlab_x.y.z-omnibus-x.ubuntu.12.04_amd64.deb # this is the .deb you downloaded sudo gitlab-ctl reconfigure</code></p>
<h3 id="Debian-7-4"><a href="#Debian-7-4" class="headerlink" title="Debian 7.4"></a>Debian 7.4</h3><p><code>sudo apt-get install openssh-server sudo apt-get install exim4-daemon-light sudo dpkg -i gitlab-x.y.z.deb # this is the .deb you downloaded sudo gitlab-ctl reconfigure</code></p>
<blockquote>
<p>during the exim installation you may follow<br><a href="http://alexatnet.com/references/server-setup-debian/send-only-mail-server-with-exim" target="_blank" rel="noopener">http://alexatnet.com/references/server-setup-debian/send-only-mail-server-with-exim</a><br>to ensure you get a secure mailserver</p>
</blockquote>
<h3 id="CentOS-6-5"><a href="#CentOS-6-5" class="headerlink" title="CentOS 6.5"></a>CentOS 6.5</h3><p><code>sudo yum install openssh-server sudo yum install postfix # sendmail or exim is also OK sudo rpm -i gitlab-x.y.z_omnibus-x.el6.x86_64.rpm # this is the .rpm you downloaded sudo gitlab-ctl reconfigure sudo lokkit -s http -s ssh # open up the firewall for HTTP and SSH requests</code></p>
<h3 id="After-installation"><a href="#After-installation" class="headerlink" title="After installation"></a>After installation</h3><p>Run <code>sudo gitlab-ctl status</code>; the output should look like this:</p>
<p><code>run: nginx: (pid 972) 7s; run: log: (pid 971) 7s run: postgresql: (pid 962) 7s; run: log: (pid 959) 7s run: redis: (pid 964) 7s; run: log: (pid 963) 7s run: sidekiq: (pid 967) 7s; run: log: (pid 966) 7s run: unicorn: (pid 961) 7s; run: log: (pid 960) 7s</code></p>
<blockquote>
<p>Your GitLab instance should reachable over HTTP at the IP or hostname of<br>your server. You can login as an admin user with username <code>root</code> and<br>password <code>5iveL!fe</code>.</p>
</blockquote>
<h3 id="Common-installation-problems"><a href="#Common-installation-problems" class="headerlink" title="Common installation problems"></a>Common installation problems</h3><h4 id="Reconfigure-freezes-at-ruby-block-supervise-redis-sleep-action-run"><a href="#Reconfigure-freezes-at-ruby-block-supervise-redis-sleep-action-run" class="headerlink" title="Reconfigure freezes at ruby_block[supervise_redis_sleep] action run"></a>Reconfigure freezes at <code>ruby_block[supervise_redis_sleep] action run</code></h4><p>This happens when Runit has not been installed succesfully during<br><code>gitlab-ctl reconfigure</code>. The most common cause for a failed Runit<br>installation is installing omnibus-gitlab on an unsupported platform.<br>Solution: double check on the download page whether you downloaded a<br>package for the correct operating system.</p>
<ul>
<li>Updating</li>
</ul>
<blockquote>
<p>For update instructions, see <a href="doc/update.md">the update guide</a>.</p>
</blockquote>
<ul>
<li>Starting and stopping</li>
</ul>
<blockquote>
<p>After omnibus-gitlab is installed and configured, your server will have a Runit service directory (<code>runsvdir</code>) process running that gets started at boot via <code>/etc/inittab</code> or the <code>/etc/init/gitlab-runsvdir.conf</code> Upstart resource. You should not have to deal with the <code>runsvdir</code> process directly; you can use the <code>gitlab-ctl</code> front-end instead.</p>
</blockquote>
<blockquote>
<p>You can start, stop or restart GitLab and all of its components with the following commands.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line"></span><br><span class="line"> Start all GitLab components</span><br><span class="line"></span><br><span class="line">sudo gitlab-ctl start</span><br><span class="line"></span><br><span class="line">Stop all GitLab components</span><br><span class="line"></span><br><span class="line">sudo gitlab-ctl stop</span><br><span class="line"></span><br><span class="line"> Restart all GitLab components</span><br><span class="line"></span><br><span class="line">sudo gitlab-ctl restart</span><br></pre></td></tr></table></figure>

<p>It is also possible to start, stop or restart individual components.</p>
<p><code>shell sudo gitlab-ctl restart unicorn</code></p>
<ul>
<li>Configuration</li>
</ul>
<h3 id="Creating-the-gitlab-rb-configuration-file"><a href="#Creating-the-gitlab-rb-configuration-file" class="headerlink" title="Creating the gitlab.rb configuration file"></a>Creating the gitlab.rb configuration file</h3><p><code>shell sudo mkdir -p /etc/gitlab sudo touch /etc/gitlab/gitlab.rb sudo chmod 600 /etc/gitlab/gitlab.rb</code></p>
<h3 id="Below-several-examples-are-given-for-settings-in"><a href="#Below-several-examples-are-given-for-settings-in" class="headerlink" title="Below several examples are given for settings in"></a>Below several examples are given for settings in</h3><p><code>/etc/gitlab/gitlab.rb</code>. Please restart each time you made a change.</p>
<h3 id="Configuring-the-external-URL-for-GitLab"><a href="#Configuring-the-external-URL-for-GitLab" class="headerlink" title="Configuring the external URL for GitLab"></a>Configuring the external URL for GitLab</h3><blockquote>
<p>In order for GitLab to display correct repository clone links to your<br>users it needs to know the URL under which it is reached by your users,<br>e.g. <code>http://gitlab.example.com</code>. Add the following line to<br><code>/etc/gitlab/gitlab.rb</code>:</p>
</blockquote>
<p><code>ruby external_url &quot;http://gitlab.example.com&quot;</code></p>
<p>Run <code>sudo gitlab-ctl reconfigure</code> for the change to take effect.</p>
<h3 id="Storing-Git-data-in-an-alternative-directory"><a href="#Storing-Git-data-in-an-alternative-directory" class="headerlink" title="Storing Git data in an alternative directory"></a>Storing Git data in an alternative directory</h3><blockquote>
<p>By default, omnibus-gitlab stores Git repository data in<br><code>/var/opt/gitlab/git-data</code>. You can change this location by adding the<br>following line to <code>/etc/gitlab/gitlab.rb</code>.</p>
</blockquote>
<p><code>ruby git_data_dir &quot;/mnt/nas/git-data&quot;</code></p>
<p>Run <code>sudo gitlab-ctl reconfigure</code> for the change to take effect.</p>
<h3 id="Setting-up-LDAP-sign-in"><a href="#Setting-up-LDAP-sign-in" class="headerlink" title="Setting up LDAP sign-in"></a>Setting up LDAP sign-in</h3><blockquote>
<p>If you have an LDAP directory service such as Active Directory, you can<br>configure GitLab so that your users can sign in with their LDAP<br>credentials. Add the following to <code>/etc/gitlab/gitlab.rb</code>, edited for<br>your server.</p>
</blockquote>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">These settings are documented <span class="keyword">in</span> more detail at</span><br><span class="line"><span class="symbol">https:</span>/<span class="regexp">/gitlab.com/gitlab</span>-org/gitlab-ce/blob/master/config/gitlab.yml.example\<span class="comment">#L118</span></span><br><span class="line"></span><br><span class="line">gitlab\_rails[<span class="string">'ldap\_enabled'</span>] = <span class="literal">true</span> gitlab\_rails[<span class="string">'ldap\_host'</span>] =</span><br><span class="line"><span class="string">'hostname of LDAP server'</span> gitlab\_rails[<span class="string">'ldap\_port'</span>] = <span class="number">389</span></span><br><span class="line">gitlab\_rails[<span class="string">'ldap\_uid'</span>] = <span class="string">'sAMAccountName'</span></span><br><span class="line">gitlab\_rails[<span class="string">'ldap\_method'</span>] = <span class="string">'plain'</span> \<span class="comment"># 'ssl' or 'plain'</span></span><br><span class="line">gitlab\_rails[<span class="string">'ldap\_bind\_dn'</span>] = <span class="string">'CN=query</span></span><br><span class="line"><span class="string">user,CN=Users,DC=mycorp,DC=com'</span> gitlab\_rails[<span class="string">'ldap\_password'</span>] = <span class="string">'query</span></span><br><span class="line"><span class="string">user password'</span> gitlab\_rails[<span class="string">'ldap\_allow\_username\_or\_email\_login'</span>]</span><br><span class="line">= <span class="literal">true</span> gitlab\_rails[<span class="string">'ldap\_base'</span>] = <span class="string">'DC=mycorp,DC=com'</span></span><br><span class="line"></span><br><span class="line">GitLab Enterprise Edition only</span><br><span class="line"></span><br><span class="line">gitlab\_rails[<span class="string">'ldap\_group\_base'</span>] = <span class="string">''</span> \<span class="comment"># Example:</span></span><br><span class="line"><span class="string">'OU=groups,DC=mycorp,DC=com'</span> gitlab\_rails[<span class="string">'ldap\_user\_filter'</span>] = <span class="string">''</span> \<span class="comment">#</span></span><br><span class="line"><span class="symbol">Example:</span> <span class="string">'(memberOf=CN=my department,OU=groups,DC=mycorp,DC=com)'</span></span><br></pre></td></tr></table></figure>

<p>Run <code>sudo gitlab-ctl reconfigure</code> for the LDAP settings to take effect.</p>
<h3 id="Enable-HTTPS"><a href="#Enable-HTTPS" class="headerlink" title="Enable HTTPS"></a>Enable HTTPS</h3><blockquote>
<p>By default, omnibus-gitlab runs does not use HTTPS. If you want to enable HTTPS you can add the following line to <code>/etc/gitlab/gitlab.rb</code>.</p>
</blockquote>
<p><code>ruby external_url &quot;https://gitlab.example.com&quot;</code></p>
<p>Redirect <code>HTTP</code> requests to <code>HTTPS</code>.</p>
<p><code>ruby external_url &quot;https://gitlab.example.com&quot; nginx[&#39;redirect_http_to_https&#39;] = true</code></p>
<p>Change the default port and the ssl certificate locations.</p>
<p><code>ruby external_url &quot;https://gitlab.example.com:2443&quot; nginx[&#39;ssl_certificate&#39;] = &quot;/etc/gitlab/ssl/gitlab.crt&quot; nginx[&#39;ssl_certificate_key&#39;] = &quot;/etc/gitlab/ssl/gitlab.key&quot;</code></p>
<p>Create the default ssl certifcate directory and add the files:</p>
<figure class="highlight plain"><figcaption><span>mkdir -p</span><a href="/etc/gitlab/ssl">&& sudo chmod 700 /etc/gitlab/ssl</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo cp gitlab.example.com.crt gitlab.example.com.key /etc/gitlab/ssl/</span><br><span class="line"></span><br><span class="line">run lokkit to open https on the firewall</span><br><span class="line"></span><br><span class="line">sudo lokkit -s https</span><br><span class="line"></span><br><span class="line">if you are using a non standard https port</span><br><span class="line"></span><br><span class="line">sudo lokkit -p 2443:tcp</span><br></pre></td></tr></table></figure>

<p>Run <code>sudo gitlab-ctl reconfigure</code> for the change to take effect.</p>
<h3 id="Changing-gitlab-yml-settings"><a href="#Changing-gitlab-yml-settings" class="headerlink" title="Changing gitlab.yml settings"></a>Changing gitlab.yml settings</h3><blockquote>
<p>Some of GitLab’s features can be customized through <a href="https://gitlab.com/gitlab-org/gitlab-ce/blob/master/config/gitlab.yml.example" target="_blank" rel="noopener">gitlab.yml</a>. If you want to change a <code>gitlab.yml</code> setting with omnibus-gitlab, you need to do so via <code>/etc/gitlab/gitlab.rb</code>. The translation works as follows.</p>
</blockquote>
<p>In <code>gitlab.yml</code>, you will find structure like this:</p>
<p><code>yaml production: &amp;base   gitlab:     default_projects_limit: 10</code></p>
<p>In <code>gitlab.rb</code>, this translates to:</p>
<p><code>ruby gitlab_rails[&#39;gitlab_default_projects_limit&#39;] = 10</code></p>
<p>What happens here is that we forget about <code>production: &amp;base</code>, and join<br><code>gitlab:</code> with <code>default_projects_limit:</code> into<br><code>gitlab_default_projects_limit</code>. Note that not all <code>gitlab.yml</code> settings<br>can be changed via <code>gitlab.rb</code> yet; see the <a href="https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/files/gitlab-cookbooks/gitlab/templates/default/gitlab.yml.erb" target="_blank" rel="noopener">gitlab.yml ERB<br>template</a>.<br>If you think an attribute is missing please create a merge request on<br>the omnibus-gitlab repository.</p>
<p>Run <code>sudo gitlab-ctl reconfigure</code> for changes in <code>gitlab.rb</code> to take<br>effect.</p>
<h2 id="Backups"><a href="#Backups" class="headerlink" title="Backups"></a>Backups</h2><h3 id="Creating-an-application-backup"><a href="#Creating-an-application-backup" class="headerlink" title="Creating an application backup"></a>Creating an application backup</h3><p>To create a backup of your repositories and GitLab metadata, run the<br>following command.</p>
<p><code>shell sudo gitlab-rake gitlab:backup:create</code></p>
<p>This will store a tar file in <code>/var/opt/gitlab/backups</code>. The filename<br>will look like <code>1393513186_gitlab_backup.tar</code>, where 1393513186 is a<br>timestamp.</p>
<h3 id="Scheduling-a-backup"><a href="#Scheduling-a-backup" class="headerlink" title="Scheduling a backup"></a>Scheduling a backup</h3><p>To schedule a cron job that backs up your repositories and GitLab<br>metadata, use the root user:</p>
<p><code>sudo su - crontab -e</code></p>
<p>There, add the following line to schedule the backup for everyday at 2<br>AM:</p>
<p><code>0 2 * * * /opt/gitlab/bin/gitlab-rake gitlab:backup:create</code></p>
<h3 id="Restoring-an-application-backup"><a href="#Restoring-an-application-backup" class="headerlink" title="Restoring an application backup"></a>Restoring an application backup</h3><p>We will assume that you have installed GitLab from an omnibus package<br>and run <code>sudo gitlab-ctl reconfigure</code> at least once.</p>
<p>First make sure your backup tar file is in <code>/var/opt/gitlab/backups</code>.</p>
<p><code>shell sudo cp 1393513186_gitlab_backup.tar /var/opt/gitlab/backups/</code></p>
<p>Next, restore the backup by running the restore command. You need to<br>specify the timestamp of the backup you are restoring.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Stop processes that are connected to the database</span><br><span class="line"></span><br><span class="line">sudo gitlab-ctl stop unicorn sudo gitlab-ctl stop sidekiq</span><br><span class="line"></span><br><span class="line">DROP THE CURRENT DATABASE; workaround for a Postgres backup restore bug in GitLab 6.6</span><br><span class="line"></span><br><span class="line">sudo -u gitlab-psql /opt/gitlab/embedded/bin/dropdb gitlabhq\_production</span><br><span class="line"></span><br><span class="line">This command will overwrite the contents of your GitLab database!</span><br><span class="line"></span><br><span class="line">sudo gitlab-rake gitlab:backup:restore BACKUP=1393513186</span><br><span class="line"></span><br><span class="line">Start GitLab</span><br><span class="line"></span><br><span class="line">sudo gitlab-ctl start</span><br></pre></td></tr></table></figure>

<p>If there is a GitLab version mismatch between your backup tar file and<br>the installed version of GitLab, the restore command will abort with an<br>error. Install a package for the <a href="https://www.gitlab.com/downloads/archives/" target="_blank" rel="noopener">required<br>version</a> and try again.</p>
<h3 id="Invoking-Rake-tasks"><a href="#Invoking-Rake-tasks" class="headerlink" title="Invoking Rake tasks"></a>Invoking Rake tasks</h3><p>To invoke a GitLab Rake task, use <code>gitlab-rake</code>. For example:</p>
<p><code>shell sudo gitlab-rake gitlab:check</code></p>
<p>Contrary to with a traditional GitLab installation, there is no need to<br>change the user or the <code>RAILS_ENV</code> environment variable; this is taken<br>care of by the <code>gitlab-rake</code> wrapper script.</p>
<h3 id="Directory-structure"><a href="#Directory-structure" class="headerlink" title="Directory structure"></a>Directory structure</h3><p>Omnibus-gitlab uses four different directories.</p>
<ul>
<li><code>/opt/gitlab</code> holds application code for GitLab and its<br>dependencies.</li>
<li><code>/var/opt/gitlab</code> holds application data and configuration files<br>that <code>gitlab-ctl reconfigure</code> writes to.</li>
<li><code>/etc/gitlab</code> holds configuration files for omnibus-gitlab. These<br>are the only files that you should ever have to edit manually.</li>
<li><code>/var/log/gitlab</code> contains all log data generated by components of<br>omnibus-gitlab.</li>
</ul>
<h3 id="Starting-a-Rails-console-session"><a href="#Starting-a-Rails-console-session" class="headerlink" title="Starting a Rails console session"></a>Starting a Rails console session</h3><p>If you need access to a Rails production console for your GitLab<br>installation you can start one with the command below. Please be warned<br>that it is very easy to inadvertently modify, corrupt or destroy data<br>from the console.</p>
<p><code>shell sudo /opt/gitlab/bin/gitlab-rails console</code></p>
<p>This will only work after you have run <code>gitlab-ctl reconfigure</code> at least<br>once.</p>
<h3 id="Using-a-non-packaged-database-management-server"><a href="#Using-a-non-packaged-database-management-server" class="headerlink" title="Using a non-packaged database management server"></a>Using a non-packaged database management server</h3><p>If you do not want to use the built-in Postgres server of omnibus-gitlab<br>or if you want to use MySQL (GitLab Enterprise Edition only) you can do<br>so as follows.</p>
<p>Important note: if you are connecting omnibus-gitlab to an existing<br>GitLab database you should create a backup before attempting this<br>procedure.</p>
<h3 id="Create-a-user-and-database-for-GitLab"><a href="#Create-a-user-and-database-for-GitLab" class="headerlink" title="Create a user and database for GitLab"></a>Create a user and database for GitLab</h3><p>First, set up your database server according to the <a href="https://gitlab.com/gitlab-org/gitlab-ce/blob/master/doc/install/installation.md#5-database" target="_blank" rel="noopener">upstream GitLab<br>instructions</a>.<br>If you want to keep using an existing GitLab database you can skip this<br>step.</p>
<h3 id="Configure-omnibus-gitlab-to-connect-to-it"><a href="#Configure-omnibus-gitlab-to-connect-to-it" class="headerlink" title="Configure omnibus-gitlab to connect to it"></a>Configure omnibus-gitlab to connect to it</h3><p>Next, we add the following settings to <code>/etc/gitlab/gitlab.rb</code>.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Disable the built-<span class="keyword">in</span> Postgres</span><br><span class="line"></span><br><span class="line">postgresql[<span class="string">'enable'</span>] = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">Fill <span class="keyword">in</span> the values <span class="keyword">for</span> database.yml</span><br><span class="line"></span><br><span class="line">gitlab\_rails[<span class="string">'db\_adapter'</span>] = <span class="string">'mysql2'</span> gitlab\_rails[<span class="string">'db\_encoding'</span>] =</span><br><span class="line"><span class="string">'utf8'</span> gitlab\_rails[<span class="string">'db\_host'</span>] = <span class="string">'127.0.0.1'</span> gitlab\_rails[<span class="string">'db\_port'</span>]</span><br><span class="line">= <span class="string">'3306'</span> gitlab\_rails[<span class="string">'db\_username'</span>] = <span class="string">'git'</span></span><br><span class="line">gitlab\_rails[<span class="string">'db\_password'</span>] = <span class="string">'password'</span></span><br></pre></td></tr></table></figure>

<p>Parameters such as <code>db_adapter</code> correspond to <code>adapter</code> in<br><code>database.yml</code>; see the upstream GitLab examples for<br><a href="https://gitlab.com/gitlab-org/gitlab-ce/blob/master/config/database.yml.postgresql" target="_blank" rel="noopener">Postgres</a> and <a href="https://gitlab.com/gitlab-org/gitlab-ce/blob/master/config/database.yml.mysql" target="_blank" rel="noopener">MySQL</a>. We remind you that <code>/etc/gitlab/gitlab.rb</code> should have file permissions <code>0600</code> because it contains plaintext passwords.</p>
<p>Run <code>sudo gitlab-ctl reconfigure</code> for the change to take effect.</p>
<h3 id="Seed-the-database-fresh-installs-only"><a href="#Seed-the-database-fresh-installs-only" class="headerlink" title="Seed the database (fresh installs only)"></a>Seed the database (fresh installs only)</h3><p>Omnibus-gitlab will not automatically seed your external database. Run<br>the following command to import the schema and create the first admin<br>user:</p>
<p><code>shell sudo gitlab-rake gitlab:setup</code></p>
<p>This is a destructive command; do not run it on an existing database!</p>
<h3 id="Building-your-own-package"><a href="#Building-your-own-package" class="headerlink" title="Building your own package"></a>Building your own package</h3><p>See <a href="doc/build.md">the separate build documentation</a>.</p>
<h3 id="Running-a-custom-GitLab-version"><a href="#Running-a-custom-GitLab-version" class="headerlink" title="Running a custom GitLab version"></a>Running a custom GitLab version</h3><p>It is not recommended to make changes to any of the files in<br><code>/opt/gitlab</code> after installing omnibus-gitlab: they will either conflict<br>with or be overwritten by future updates. If you want to run a custom<br>version of GitLab you can <a href="doc/build.md">build your own package</a> or use<br><a href="https://gitlab.com/gitlab-org/gitlab-ce/blob/master/README.md" target="_blank" rel="noopener">another installation<br>method</a>.</p>
<h3 id="Acknowledgments"><a href="#Acknowledgments" class="headerlink" title="Acknowledgments"></a>Acknowledgments</h3><p>This omnibus installer project is based on the awesome work done by Chef<br>in<br><a href="https://github.com/opscode/omnibus-chef-server" target="_blank" rel="noopener">omnibus-chef-server</a>.</p>

            </div>
          

    
      <footer class="post-footer">
        <div class="post-tags">
          
            <a href="/tags/git/">git</a>
          
        </div>

        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2014/05/10/upgrade-eclipse-import-plugins/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">升级 Eclipse 4.3, 导入老版本安装的plugins</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/2014/04/25/weinre-remote-debug-web-page/">
        <span class="next-text nav-default">用weinre远程调试web页面</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon"><span class="copyright-year">
    
        &copy;
    
        2012 -
    
    2021
    <span class="footer-author">Neo.</span>
    <span class="power-by">
        Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a>
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    


    


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  

    <script type="text/javascript" src="/js/src/theme.js?v=1.1"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1"></script>

    

  
  <script type="application/ld+json">
  {
  "@context": "http://www.schema.org",
  "@type": "Person",
  "@id": "https://huangyijie.com/about/",
  "name": "黄奕杰",
  "alternateName": "Henry Huang",
  "nationality": "中国",
  "birthPlace" : {
    "@type": "Place",
      "address": {
        "@type": "PostalAddress",
      "addressLocality": "汕头市",
      "addressRegion": "广东省",
          "addressCountry": "中国"
    }
  },
  "gender": "Male",
  "Description": "Software Engineer",
  "disambiguatingDescription": "Full stack software engineer, focus on Java and JavaScript.",
  "jobTitle": "Software Engineer",
  "url": "https://huangyijie.com",
  "image": "https://s.gravatar.com/avatar/4e0e61fdf1b2bcfb4ee31da27601fe6b?s=512&r=g",
  "address": {
    "@type": "PostalAddress",
    "addressLocality": "深圳市",
    "addressRegion": "广东省",
    "addressCountry": "中国"
  },
  "sameAs": [
    "http://weibo.com/626242034",
    "https://github.com/henryhuang",
    "https://unsplash.com/@henryhh"
    ]
  }
  </script>
  </body>
</html>
